{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="blog-post-container">
        <!-- Breadcrumbs -->
        {% include 'good/includes/breadcrumbs.html' %}

        <div class="blog-container blog-post-layout">
            <!-- Main Content -->
            <div class="blog-post-content">
                <!-- Post Header -->
                <div class="post-header">
                    {% if post.category %}
                        <a href="{% url 'blog_category' post.category.slug %}" class="post-category-label">{{ post.category.name }}</a>
                    {% endif %}
                    <h1 class="post-title">{{ post.title }}</h1>
                    <div class="post-meta">
                        <span class="post-date">{{ post.pub_date|date:"d F Y" }}</span>
                        <span class="post-views">{{ post.views }} просмотров</span>
                    </div>
                </div>

                <!-- Post Featured Image -->
                {% if post.image %}
                    <div class="post-featured-image">
                        <img src="{{ post.image.url }}" alt="{{ post.title }}">
                    </div>
                {% endif %}

                <!-- Post Content -->
                <div class="post-content">
                    {{ post.content|safe }}
                </div>

                <!-- Post Tags -->
                {% if post.tags.all %}
                    <div class="post-tags">
                        <span class="tags-title">Теги:</span>
                        {% for tag in post.tags.all %}
                            <a href="{% url 'blog_tag' tag.slug %}" class="tag-item">{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Post Share -->
                <div class="post-share">
                    <span class="share-title">Поделиться:</span>
                    <div class="share-buttons">
                        <a href="https://t.me/share/url?url={{ request.build_absolute_uri }}&text={{ post.title }}" target="_blank" class="share-button telegram">
                            <img src="{% static 'images/icons/footer__telegram.svg' %}" alt="Telegram">
                        </a>
                        <a href="https://vk.com/share.php?url={{ request.build_absolute_uri }}" target="_blank" class="share-button vk">
                            <img src="{% static 'images/icons/vk.svg' %}" alt="VK" onerror="this.src='{% static 'images/icons/vk.png' %}'; this.onerror=null;">
                        </a>
                        <a href="https://wa.me/?text={{ post.title }}%20{{ request.build_absolute_uri }}" target="_blank" class="share-button whatsapp">
                            <img src="{% static 'images/icons/footer__whatsapp.svg' %}" alt="WhatsApp">
                        </a>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="blog-sidebar">
                <div class="sidebar-box">
                    <h3 class="sidebar-title">Полезные материалы</h3>
                    <ul class="category-list">
                        <li><a href="{% url 'blog' %}">Все статьи</a></li>
                        {% for cat in categories %}
                            <li>
                                <a href="{% url 'blog_category' cat.slug %}" class="{% if post.category.slug == cat.slug %}active{% endif %}">
                                    {{ cat.name }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="sidebar-box">
                    <h3 class="sidebar-title">Популярные статьи</h3>
                    <ul class="popular-posts">
                        {% for pop_post in popular_posts %}
                            <li>
                                <a href="{% url 'blog_post' pop_post.slug %}">
                                    <div class="post-mini-image">
                                        {% if pop_post.image %}
                                            <img src="{{ pop_post.image.url }}" alt="{{ pop_post.title }}">
                                        {% else %}
                                            <img src="{% static 'images/mainpage/zavod.webp' %}" alt="{{ pop_post.title }}">
                                        {% endif %}
                                    </div>
                                    <div class="post-mini-content">
                                        <h4>{{ pop_post.title }}</h4>
                                        <span class="post-date">{{ pop_post.pub_date|date:"d.m.Y" }}</span>
                                    </div>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="sidebar-box">
                    <h3 class="sidebar-title">Поиск по блогу</h3>
                    <form action="{% url 'blog' %}" method="get" class="blog-search-form">
                        <input type="text" name="q" placeholder="Поиск по блогу..." class="search-input">
                        <button type="submit" class="search-button">
                            <img src="{% static 'images/icons/search.svg' %}" alt="Поиск" onerror="this.src='{% static 'images/icons/search.png' %}'; this.onerror=null;">
                        </button>
                    </form>
                </div>
            </aside>
        </div>

        <!-- Related Posts -->
        {% if related_posts %}
            <div class="related-posts">
                <h2 class="related-posts-title">Похожие статьи</h2>
                <div class="blog-posts-grid related-posts-grid">
                    {% for rel_post in related_posts %}
                        <div class="blog-post-card">
                            <div class="post-image">
                                {% if rel_post.image %}
                                    <img src="{{ rel_post.image.url }}" alt="{{ rel_post.title }}">
                                {% else %}
                                    <img src="{% static 'images/mainpage/zavod.webp' %}" alt="{{ rel_post.title }}">
                                {% endif %}
                                {% if rel_post.category %}
                                    <a href="{% url 'blog_category' rel_post.category.slug %}" class="post-category">{{ rel_post.category.name }}</a>
                                {% endif %}
                            </div>
                            <div class="post-info">
                                <h3 class="post-title">
                                    <a href="{% url 'blog_post' rel_post.slug %}">{{ rel_post.title }}</a>
                                </h3>
                                <div class="post-meta">
                                    <span class="post-date">{{ rel_post.pub_date|date:"d.m.Y" }}</span>
                                    <span class="post-views">{{ rel_post.views }} просмотров</span>
                                </div>
                                <div class="post-excerpt">
                                    <p>{{ rel_post.excerpt }}</p>
                                </div>
                                <div class="post-actions">
                                    <a href="{% url 'blog_post' rel_post.slug %}" class="read-more-btn">Читать далее</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        <!-- CTA Section -->
        <section class="blog-cta">
            <div class="cta-content">
                <h2>Остались вопросы по бетону и строительству?</h2>
                <p>Свяжитесь с нашими специалистами для получения профессиональной консультации</p>
                <div class="cta-buttons">
                    <button class="btn-primary hero__button--popup" type="button">Получить консультацию</button>
                    {% if city_slug %}
                        <a href="{% url 'catalog' city_slug=city_slug %}" class="btn-secondary">Перейти в каталог</a>
                    {% else %}
                        <a href="#" class="btn-secondary" onclick="openCityModal();">Перейти в каталог</a>
                    {% endif %}
                </div>
            </div>
        </section>
    </div>
{% endblock %}