{% if tags_by_category %}
<div class="sidebar-box">
    <h3 class="sidebar-title">Фильтр по применению</h3>

    <!-- Кнопка "Все" для сброса фильтра -->
    <div class="tags-filter">
        {% if current_category %}
            <a href="{% url 'category_or_tag' city_slug=city_slug slug=current_category.slug %}"
               class="tag-filter-item {% if not selected_tag %}active{% endif %}">
                Все товары
            </a>
        {% else %}
            <a href="{% url 'catalog' city_slug=city_slug %}"
               class="tag-filter-item {% if not selected_tag %}active{% endif %}">
                Все товары
            </a>
        {% endif %}
    </div>

    {% for tag_category, tags_list in tags_by_category.items %}
        <div class="tags-category">
            <h4>{{ tag_category }}</h4>
            <div class="tags-filter">
                {% for tag in tags_list %}
                    <a href="{% url 'category_or_tag' city_slug=city_slug slug=tag.slug %}"
                       class="tag-filter-item {% if selected_tag and selected_tag.slug == tag.slug %}active{% endif %}">
                        {{ tag.name }}
                        <span class="tag-count">({{ tag.products_count }})</span>
                    </a>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>
{% endif %}